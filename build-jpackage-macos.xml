<?xml version="1.0" encoding="UTF-8"?>
<project name="Shimeji-ee-macOS" basedir="." default="jpackage-macos">

	<property name="version" value="1.0.9" />

	<!-- 使用 jpackage 创建 macOS 应用程序包 -->
	<target name="jpackage-macos">
		<mkdir dir="target/jpackage-macos" />
		<delete dir="target/jpackage-macos" />
		<mkdir dir="target/jpackage-macos" />

		<!-- 准备应用程序资源 -->
		<mkdir dir="target/jpackage-macos/input" />
		<copy file="target/Shimeji-ee.jar" todir="target/jpackage-macos/input" />

		<!-- 执行 jpackage 命令 -->
		<exec executable="jpackage" dir="target/jpackage-macos" failonerror="true">
			<arg value="--input" />
			<arg value="input" />
			<arg value="--main-jar" />
			<arg value="Shimeji-ee.jar" />
			<arg value="--main-class" />
			<arg value="com.group_finity.mascot.Main" />
			<arg value="--name" />
			<arg value="Shimeji-ee" />
			<arg value="--app-version" />
			<arg value="${version}" />
			<arg value="--description" />
			<arg value="Shimeji-ee Desktop Pet Application" />
			<arg value="--vendor" />
			<arg value="Shimeji-ee Group" />
			<arg value="--icon" />
			<arg value="../../img/icon.png" />
			<arg value="--type" />
			<arg value="app-image" />
			<arg value="--dest" />
			<arg value="." />
			<arg value="--java-options" />
			<arg value="--enable-native-access=ALL-UNNAMED" />
			<arg value="--java-options" />
			<arg value="--add-opens=java.base/java.lang=ALL-UNNAMED" />
			<arg value="--java-options" />
			<arg value="--add-opens=java.desktop/sun.awt=ALL-UNNAMED" />
			<arg value="--java-options" />
			<arg value="--add-opens=java.desktop/java.awt=ALL-UNNAMED" />
		</exec>

		<!-- 复制配置和资源文件到应用程序包内的Resources目录 -->
		<copy todir="target/jpackage-macos/Shimeji-ee.app/Contents/app/conf">
			<fileset dir="conf" />
		</copy>
		<copy todir="target/jpackage-macos/Shimeji-ee.app/Contents/app/img">
			<fileset dir="img" />
		</copy>

		<echo message="macOS app bundle created successfully!" />
		<echo message="App bundle location: target/jpackage-macos/Shimeji-ee.app" />
	</target>

</project>